// ===== TRADUCTIONS =====
const translations = {
  fr: {
    // HERO
    tagline: "Votre partenaire immobilier en MÃ©diterranÃ©e",
    subtitle:
      "Conseil acheteur (FRâ€“ENâ€“IT). SpÃ©cialiste Espagne & Maroc : recherche, analyse, visites, nÃ©gociation, sÃ©curisation jusquâ€™Ã  lâ€™acte.",
    country_maroc: "Immobilier au Maroc",
    country_espagne: "Immobilier en Espagne",
    country_italie: "Immobilier en Italie du Sud",
    country_maroc_url:
      "https://sites.google.com/view/mediterranea-property-cons-mfr/accueil?authuser=1",
    country_espagne_url:
      "https://sites.google.com/view/mediterranea-property-cons-efr/accueil?authuser=1",
    country_italie_url:
      "https://sites.google.com/view/mediterranea-property-cons-ifr/propri%C3%A9t%C3%A9s-en-vente-%C3%A0-la-une?authuser=1",

    about_title: "Ã€ propos",
    about_body:
      "Je m'appelle Serafina LOGGIA. Jâ€™accompagne des acheteurs pour investir ou sâ€™installer en Espagne, en Italie et au Maroc. Mon rÃ´le : filtrer les biens, vÃ©rifier, organiser les visites, nÃ©gocier, coordonner les dÃ©marches et sÃ©curiser lâ€™opÃ©ration jusquâ€™Ã  la signature.",
    services_title: "Ce que jâ€™apporte",
    s1: "Recherche ciblÃ©e & prÃ©sÃ©lection",
    s2: "Visites (prÃ©sentiel / vidÃ©o) & comptes rendus",
    s3: "NÃ©gociation & sÃ©curisation jusquâ€™Ã  lâ€™acte",
    s4: "Coordination locale (notaires, trad, dÃ©marches)",

    // MODALE m1
    m1_title: "Recherche ciblÃ©e & prÃ©sÃ©lection",
    m1_p1:
      "Brief prÃ©cis (budget, lieux, critÃ¨res). Veille Espagne/Maroc, filtrage des annonces.",
    m1_li1: "Cartographie quartiers / micro-marchÃ©s",
    m1_li2: "RepÃ©rage opportunitÃ©s / signaux dâ€™alerte",
    m1_li3: "PrÃ©-questions aux agences / vendeurs",

    // MODALE m2
    m2_title: "Visites (prÃ©sentiel / vidÃ©o) & comptes rendus",
    m2_p1:
      "Organisation des visites sur place ou en vidÃ©o. Analyse, avis objectif, points forts/faibles.",
    m2_li1: "Visites en prÃ©sentiel ou WhatsApp vidÃ©o",
    m2_li2: "VÃ©rifications essentielles (environnement, Ã©tat, copropriÃ©tÃ©)",
    m2_li3: "Comptes rendus dÃ©taillÃ©s & sÃ©lection finale",

    // MODALE m3
    m3_title: "NÃ©gociation & sÃ©curisation jusquâ€™Ã  lâ€™acte",
    m3_p1:
      "PrÃ©paration du dossier, stratÃ©gie de nÃ©gociation, sÃ©curisation juridique et accompagnement complet jusquâ€™Ã  la signature finale.",
    m3_li1: "StratÃ©gie de nÃ©gociation basÃ©e sur le marchÃ©",
    m3_li2: "Analyse juridique & documents clÃ©s",
    m3_li3: "Accompagnement jusquâ€™Ã  lâ€™acte",

    // MODALE m4
    m4_title: "Coordination locale (notaires, trad, dÃ©marches)",
    m4_p1:
      "Je coordonne toutes les dÃ©marches avec les acteurs locaux : notaires, avocats, traducteurs, banques, administration.",
    m4_li1: "Coordination notariale et juridique",
    m4_li2: "Traductions officielles & gestion documentaire",
    m4_li3: "Accompagnement dÃ©marches locales (NIE, banques, cadastre)",

    // CTA haut
    cta_hero_btn:
      "PrÃªt Ã  concrÃ©tiser votre projet immobilier ? Contactez-moi maintenant",
    cta_hero_whats: "Discutons sur WhatsApp",

    // POUR QUI
    who_title: "Ce service est fait pour vous siâ€¦",
    who_retirees_title: "RetraitÃ©s",
    who_retirees_text:
      "Profitez de votre retraite sans vous ruiner : villa avec piscine au prix dâ€™un studio en banlieueâ€¦ et il reste du budget.",
    who_remote_title: "TÃ©lÃ©travailleurs",
    who_remote_text:
      "Gardez votre salaire franÃ§ais, vivez mer & soleil, bureau avec vue, Ã  2h dâ€™avion de Paris.",
    who_invest_title: "Investisseurs",
    who_invest_text:
      "RepÃ©rez les opportunitÃ©s avant la foule (Espagne -Murcie, Maroc 2030â€¦) avec un cadre juridique sÃ©curisÃ©.",
    who_special_btn: "ðŸŒž SpÃ©cial RetraitÃ©s & TÃ©lÃ©travailleurs",

    // POURQUOI
    why_title: "Pourquoi investir en Espagne ou au Maroc ?",
    why_es_title: "ðŸ‡ªðŸ‡¸ Espagne",
    why_es_li1: "FiscalitÃ© attractive (loi Beckham pour certains profils)",
    why_es_li2: "Prix ~ âˆ’40% vs. cÃ´te franÃ§aise",
    why_es_li3: "2h dâ€™avion de Paris",
    why_es_li4: "CommunautÃ© francophone bien Ã©tablie",
    why_es_li5: "QualitÃ© de vie exceptionnelle",
    why_ma_title: "ðŸ‡²ðŸ‡¦ Maroc",
    why_ma_li1: "CoÃ»t de la vie ~ âˆ’50% vs. France",
    why_ma_li2: "320 jours de soleil/an",
    why_ma_li3: "Coupe du Monde 2030 â†’ valorisation attendue",
    why_ma_li4: "ProximitÃ© culturelle & gÃ©ographique",
    why_ma_li5: "Immobilier trÃ¨s accessible",
    why_guide_btn: "TÃ©lÃ©charger le guide complet",

    // COMPARATIF
    comparatif_title: "ConcrÃ¨tement, combien Ã§a change ?",

    // GUIDES
    guides_title: "Guides gratuits pour bien dÃ©marrer",
    guide1_title: "5 erreurs fatales avant dâ€™acheter au Maroc",
    guide1_text:
      "Ã‰vitez les piÃ¨ges courants : cadastre, avocat, clauses, dÃ©lais, acompteâ€¦",
    guide2_title: "Checklist : Acheter en Espagne en 2025",
    guide2_text:
      "Check-list claire : budget, NIE, notaire, fiscalitÃ©, banques, Ã©tapes clÃ©sâ€¦",
    guide3_title: "FiscalitÃ© expatriÃ©s : lâ€™essentiel",
    guide3_text:
      "Ce quâ€™il faut savoir avant de partir : rÃ©sidence fiscale, conventions, impÃ´ts.",
    guide_btn: "TÃ©lÃ©charger gratuitement",

    // TÃ‰MOIGNAGES
    temoignages_title: "Ils ont franchi le pas",
    temoignages_note:
      "Premiers clients actuellement accompagnÃ©s. TÃ©moignages et retours dâ€™expÃ©rience arrivent trÃ¨s bientÃ´t.",
    temoignages_intro:
      "Vous avez achetÃ© Ã  lâ€™Ã©tranger ? Partagez votre expÃ©rience :",
    temoignages_link: "envoyer un tÃ©moignage",

    // FAQ
    faq_title: "Questions frÃ©quentes",
    faq_q1: "Combien coÃ»tent vos services ?",
    faq_a1:
      "La plupart du temps, je suis rÃ©munÃ©rÃ©e cÃ´tÃ© vendeur. Vous ne payez donc rien directement.",
    faq_q2: "Je ne parle pas espagnol/arabe, câ€™est un problÃ¨me ?",
    faq_a2:
      "Non. Je gÃ¨re tout en franÃ§ais, anglais, italien et espagnol et je mâ€™occupe des traductions assermentÃ©es.",
    faq_q3: "Comment se dÃ©roule lâ€™accompagnement ?",
    faq_a3:
      "Brief â†’ recherche ciblÃ©e â†’ visites (sur place / vidÃ©o) â†’ nÃ©gociation â†’ sÃ©curisation juridique â†’ signature.",
    faq_q4: "Puis-je obtenir un crÃ©dit en tant quâ€™Ã©tranger ?",
    faq_a4:
      "Oui. Je vous mets en relation avec des banques partenaires en fonction de votre profil.",

    // CTA bas
    contact_whats_btn:
      "Des questions ? Je rÃ©ponds sous 24h â€“ Discutons sur WhatsApp",

    // FOOTER
    footer_text: "Â© Mediterranea Property Consulting â€“ Serafina LOGGIA"
  },

  en: {
    tagline: "Your Mediterranean buying advisor",
    subtitle:
      "Buyerâ€™s agent (FRâ€“ENâ€“IT). Focus on Spain & Morocco: search, due diligence, viewings, negotiation, deal security to completion.",
    country_maroc: "Property in Morocco",
    country_espagne: "Property in Spain",
    country_italie: "Property in Southern Italy",
    country_maroc_url:
      "https://sites.google.com/view/mediterraneapropertycons-men/accueil?authuser=1",
    country_espagne_url:
      "https://sites.google.com/view/mediterraneapropertycons-een/accueil?authuser=1",
    country_italie_url:
      "https://sites.google.com/view/mediterranea-property-cons-ien/accueil?authuser=1",

    about_title: "About",
    about_body:
      "Iâ€™m Serafina LOGGIA. I support buyers in Spain and Morocco. I shortlist properties, verify information, arrange viewings, negotiate, coordinate the process and secure the deal up to completion.",
    services_title: "What I deliver",
    s1: "Targeted search & shortlisting",
    s2: "Viewings (in-person / video) & reporting",
    s3: "Negotiation & deal security to completion",
    s4: "Local coordination (notaries, translations, admin)",

    // MODAL m1
    m1_title: "Targeted search & pre-selection",
    m1_p1:
      "Detailed brief (budget, areas, criteria). Monitoring in Spain/Morocco, filtering listings.",
    m1_li1: "Neighbourhood / micro-market mapping",
    m1_li2: "Spotting opportunities / warning signs",
    m1_li3: "Pre-screening questions for agencies / sellers",

    // MODAL m2
    m2_title: "Viewings (in-person / video) & reports",
    m2_p1:
      "Organisation of in-person or video viewings. Analysis, objective advice, strengths and weaknesses.",
    m2_li1: "In-person or WhatsApp video viewings",
    m2_li2: "Key checks (environment, condition, building)",
    m2_li3: "Detailed reports & final shortlist",

    // MODAL m3
    m3_title: "Negotiation & legal security to completion",
    m3_p1:
      "Preparation, negotiation strategy, legal verification and full support until completion.",
    m3_li1: "Negotiation strategy based on market analysis",
    m3_li2: "Legal checks & key documents",
    m3_li3: "Support until completion / deed",

    // MODAL m4
    m4_title: "Local coordination (notaries, translations, admin)",
    m4_p1:
      "I coordinate all steps with local actors: notaries, lawyers, translators, banks, administration.",
    m4_li1: "Notarial & legal coordination",
    m4_li2: "Official translations & documentation",
    m4_li3: "Support with local admin (NIE, banks, cadastre)",

    cta_hero_btn:
      "Ready to make your property project real? Get in touch now",
    cta_hero_whats: "Letâ€™s talk on WhatsApp",

    who_title: "This service is for you ifâ€¦",
    who_retirees_title: "Retirees",
    who_retirees_text:
      "Enjoy your retirement without breaking the bank: a villa with pool for the price of a studio near a big cityâ€¦ and money left over.",
    who_remote_title: "Remote workers",
    who_remote_text:
      "Keep your French salary, live by the sea and in the sun, with an office view and only 2 hours from Paris.",
    who_invest_title: "Investors",
    who_invest_text:
      "Spot opportunities before the crowd (Spain -Murcia, Morocco 2030â€¦) with a secure legal framework.",
    who_special_btn: "ðŸŒž Special Retirees & Remote workers",

    why_title: "Why invest in Spain or Morocco?",
    why_es_title: "ðŸ‡ªðŸ‡¸ Spain",
    why_es_li1: "Attractive tax regime (Beckham law for some profiles)",
    why_es_li2: "Prices ~40% lower than the French Riviera",
    why_es_li3: "Only 2 hours by plane from Paris",
    why_es_li4: "Well-established French-speaking community",
    why_es_li5: "Outstanding quality of life",
    why_ma_title: "ðŸ‡²ðŸ‡¦ Morocco",
    why_ma_li1: "Cost of living ~50% lower than in France",
    why_ma_li2: "At least 320 days of sunshine per year",
    why_ma_li3: "World Cup 2030 â†’ expected value increase",
    why_ma_li4: "Cultural and geographic proximity",
    why_ma_li5: "Very affordable real estate",
    why_guide_btn: "Download the full guide",

    comparatif_title: "In practice, how big is the difference?",

    guides_title: "Free guides to get started",
    guide1_title: "5 fatal mistakes before buying in Morocco",
    guide1_text:
      "Avoid common traps: land registry, lawyer, clauses, timing, depositâ€¦",
    guide2_title: "Checklist: Buying in Spain in 2025",
    guide2_text:
      "Clear checklist: budget, NIE, notary, tax, banks, key stepsâ€¦",
    guide3_title: "Expat tax: the essentials",
    guide3_text:
      "What you need to know before leaving: tax residency, treaties, taxes.",
    guide_btn: "Download for free",

    temoignages_title: "They took the leap",
    temoignages_note:
      "First clients currently supported. Testimonials and detailed feedback coming very soon.",
    temoignages_intro: "Already bought abroad? Share your experience:",
    temoignages_link: "send a testimonial",

    faq_title: "Frequently asked questions",
    faq_q1: "How much do your services cost?",
    faq_a1:
      "I am -most of the time- paid by the seller. You therefore donâ€™t pay anything directly.",
    faq_q2: "I donâ€™t speak Spanish/Arabic â€“ is that a problem?",
    faq_a2:
      "No. I handle everything in French, English, Italian & Spanish and I take care of certified translations.",
    faq_q3: "How does the support work?",
    faq_a3:
      "Brief â†’ targeted search â†’ viewings (in person / video) â†’ negotiation â†’ legal security â†’ completion.",
    faq_q4: "Can I get a mortgage as a foreigner?",
    faq_a4:
      "Yes. I connect you with partner banks depending on your profile.",

    contact_whats_btn:
      "Questions? I reply within 24h â€“ Letâ€™s talk on WhatsApp",

    footer_text: "Â© Mediterranea Property Consulting â€“ Serafina LOGGIA"
  },

  it: {
    tagline: "La tua consulente per acquistare nel Mediterraneo",
    subtitle:
      "Consulenza acquirente (FRâ€“ENâ€“IT). Focus Spagna & Marocco: ricerca, verifica, visite, trattativa, sicurezza fino al rogito.",
    country_maroc: "Immobili in Marocco",
    country_espagne: "Immobili in Spagna",
    country_italie: "Immobili nel Sud Italia",
    country_maroc_url:
      "https://sites.google.com/view/mediterranea-property-cons-mit/accueil?authuser=1",
    country_espagne_url:
      "https://sites.google.com/view/mediterraneapropertycons-eit/accueil?authuser=1",
    country_italie_url: "", // pas encore de page Italie en IT

    about_title: "Chi sono",
    about_body:
      "Mi chiamo Serafina LOGGIA. Accompagno chi acquista in Spagna e Marocco: preselezione immobili, verifiche, visite, negoziazione, coordinamento pratiche e sicurezza fino al rogito.",
    services_title: "Cosa offro",
    s1: "Ricerca mirata & preselezione",
    s2: "Visite (presenza / video) & report",
    s3: "Trattativa & sicurezza fino al rogito",
    s4: "Coordinamento locale (notai, traduzioni, pratiche)",

    // MODALE m1
    m1_title: "Ricerca mirata & preselezione",
    m1_p1:
      "Brief preciso (budget, zone, criteri). Monitoraggio Spagna/Marocco, filtraggio annunci.",
    m1_li1: "Mappatura quartieri / micromercati",
    m1_li2: "Individuazione opportunitÃ  / segnali dâ€™allarme",
    m1_li3: "Domande preliminari ad agenzie / venditori",

    // MODALE m2
    m2_title: "Visite (presenza / video) & report",
    m2_p1:
      "Organizzazione visite sul posto o in video. Analisi, parere obiettivo, punti di forza/debolezza.",
    m2_li1: "Visite in presenza o video WhatsApp",
    m2_li2: "Verifiche essenziali (ambiente, stato, condominio)",
    m2_li3: "Report dettagliati & selezione finale",

    // MODALE m3
    m3_title: "Trattativa & sicurezza fino al rogito",
    m3_p1:
      "Preparazione pratica, strategia di trattativa, verifica giuridica e accompagnamento completo fino al rogito.",
    m3_li1: "Strategia di trattativa basata sul mercato",
    m3_li2: "Analisi giuridica & documenti principali",
    m3_li3: "Assistenza fino al rogito",

    // MODALE m4
    m4_title: "Coordinamento locale (notai, traduzioni, pratiche)",
    m4_p1:
      "Coordino tutte le pratiche con notai, avvocati, traduttori, banche e amministrazione locale.",
    m4_li1: "Coordinamento notarile e giuridico",
    m4_li2: "Traduzioni ufficiali & gestione documenti",
    m4_li3: "Assistenza pratiche locali (NIE, banche, catasto)",

    cta_hero_btn:
      "Pronto a concretizzare il tuo progetto immobiliare? Contattami ora",
    cta_hero_whats: "Parliamone su WhatsApp",

    who_title: "Questo servizio fa per te seâ€¦",
    who_retirees_title: "Pensionati",
    who_retirees_text:
      "Goditi la pensione senza spendere una fortuna: villa con piscina al prezzo di un monolocale in periferiaâ€¦ e avanza ancora budget.",
    who_remote_title: "Lavoratori da remoto",
    who_remote_text:
      "Mantieni lo stipendio francese, vivi tra mare e sole, ufficio con vista, a 2 ore di aereo da Parigi.",
    who_invest_title: "Investitori",
    who_invest_text:
      "Individua le opportunitÃ  prima degli altri (Murcia, Marocco 2030â€¦) con un quadro giuridico sicuro.",
    who_special_btn:
      "ðŸŒž Speciale Pensionati & Remote workers",

    why_title: "PerchÃ© investire in Spagna o in Marocco?",
    why_es_title: "ðŸ‡ªðŸ‡¸ Spagna",
    why_es_li1:
      "Regime fiscale interessante (legge Beckham per alcuni profili)",
    why_es_li2:
      "Prezzi ~40% inferiori rispetto alla Costa Azzurra",
    why_es_li3: "Solo 2 ore di volo da Parigi",
    why_es_li4: "ComunitÃ  francofona ben presente",
    why_es_li5: "QualitÃ  di vita eccellente",
    why_ma_title: "ðŸ‡²ðŸ‡¦ Marocco",
    why_ma_li1:
      "Costo della vita ~50% inferiore rispetto alla Francia",
    why_ma_li2: "Almeno 320 giorni di sole allâ€™anno",
    why_ma_li3:
      "Mondiali 2030 â†’ atteso aumento di valore",
    why_ma_li4: "ProssimitÃ  culturale e geografica",
    why_ma_li5: "Immobiliare molto accessibile",
    why_guide_btn: "Scarica la guida completa",

    comparatif_title: "In pratica, quanto cambia davvero?",

    guides_title: "Guide gratuite per iniziare al meglio",
    guide1_title: "5 errori fatali prima di comprare in Marocco",
    guide1_text:
      "Evita gli errori piÃ¹ comuni: catasto, avvocato, clausole, tempi, caparraâ€¦",
    guide2_title: "Checklist: Acquistare in Spagna nel 2025",
    guide2_text:
      "Checklist chiara: budget, NIE, notaio, fiscalitÃ , banche, tappe chiaveâ€¦",
    guide3_title: "FiscalitÃ  espatriati: lâ€™essenziale",
    guide3_text:
      "Cosa sapere prima di partire: residenza fiscale, convenzioni, imposte.",
    guide_btn: "Scarica gratuitamente",

    temoignages_title: "Hanno fatto il grande passo",
    temoignages_note:
      "Primi clienti attualmente accompagnati. Testimonianze e feedback dettagliati in arrivo.",
    temoignages_intro:
      "Hai giÃ  acquistato allâ€™estero? Condividi la tua esperienza:",
    temoignages_link: "invia una testimonianza",

    faq_title: "Domande frequenti",
    faq_q1: "Quanto costano i tuoi servizi?",
    faq_a1:
      "I miei servizi sono, nella maggior parte dei casi, remunerati dalla parte venditrice. A te non costa nulla.",
    faq_q2: "Non parlo spagnolo/arabo, Ã¨ un problema?",
    faq_a2:
      "No. Gestisco tutto in francese, inglese e spagnolo e mi occupo delle traduzioni certificate dei documenti.",
    faq_q3: "Come si svolge lâ€™accompagnamento?",
    faq_a3:
      "Brief â†’ ricerca mirata â†’ visite (in presenza / video) â†’ trattativa â†’ verifica della sicurezza giuridica â†’ rogito.",
    faq_q4: "Sono straniero, posso ottenere un mutuo?",
    faq_a4:
      "SÃ¬. Ti metto in contatto con le banche partner in base al tuo profilo.",

    contact_whats_btn:
      "Domande? Ti rispondo entro 24h â€“ Parliamone su WhatsApp",

    footer_text: "Â© Mediterranea Property Consulting â€“ Serafina LOGGIA"
  }
};

// ===== LANGUE COURANTE =====
let currentLang = "fr";

// ===== LIENS GOOGLE SITES PAR PAYS & LANGUE =====
const countryLinks = {
  ma: { // Maroc
    fr: "https://sites.google.com/view/mediterranea-property-cons-mfr",
    en: "https://sites.google.com/view/mediterranea-property-cons-mit",
    it: "https://sites.google.com/view/mediterranea-property-cons-mit"
  },
  es: { // Espagne
    fr: "https://sites.google.com/view/mediterranea-property-cons-efr",
    en: "https://sites.google.com/view/mediterraneapropertycons-een",
    it: "https://sites.google.com/view/mediterraneapropertycons-eit"
  },
  it: { // Italie
    fr: "https://sites.google.com/view/mediterranea-property-cons-ifr/propri%C3%A9t%C3%A9s-en-vente-%C3%A0-la-une",
    en: "https://sites.google.com/view/mediterranea-property-cons-ifr"
    // le jour oÃ¹ tu auras une version IT dÃ©diÃ©e :
    // it: "https://sites.google.com/view/TON-SITE-ITALIE-IT"
  }
};

// Ouvre la bonne page selon le pays + la langue active
function openCountry(code) {
  const links = countryLinks[code];
  if (!links) return;

  // si la langue n'existe pas pour ce pays, on essaie fr, puis en
  const url = links[currentLang] || links.fr || links.en;
  if (!url) return;

  window.open(url, "_blank");
}

// ===== CHANGEMENT DE LANGUE =====
function switchLang(lang) {
  const dict = translations[lang];
  if (!dict) return;

  currentLang = lang;

  // 1) Mise Ã  jour des textes
  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    if (dict[key] !== undefined) {
      el.textContent = dict[key];
    }
  });

  // 2) Ã‰tat visuel des boutons de langue
  document.querySelectorAll(".lang-switch button").forEach((btn) => {
    btn.classList.toggle("active", btn.dataset.lang === lang);
  });
}

// ===== INIT Ã€ CHARGEMENT =====
document.addEventListener("DOMContentLoaded", () => {
  // langue par dÃ©faut
  switchLang("fr");

  // boutons EN / IT
  document.querySelectorAll(".lang-switch button").forEach((btn) => {
    btn.addEventListener("click", () => {
      const lang = btn.dataset.lang;
      if (lang) switchLang(lang);
    });
  });

  // ===== BOUTONS PAYS (Maroc / Espagne / Italie) =====
  const countryMap = {
    maroc: "ma",
    espagne: "es",
    italie: "it"
  };

  // on Ã©coute le clic sur chaque pill
  document.querySelectorAll(".country-pill").forEach((btn) => {
    btn.addEventListener("click", () => {
      const key = btn.dataset.country; // "maroc", "espagne" ou "italie"
      const code = countryMap[key];    // "ma", "es" ou "it"
      if (code) {
        openCountry(code);            // ouvre la bonne page Google Sites
      }
    });
  });
});


// ===== GESTION E-MAIL (HÃ‰RO + TÃ‰MOIGNAGES) =====

// Affiche la boÃ®te e-mail du hÃ©ros (Top)
function revealEmail(tag) {
  const box = document.getElementById("emailBox" + tag);
  if (!box) return;

  if (box.style.display === "none" || box.style.display === "") {
    box.style.display = "block";
  } else {
    box.style.display = "none";
  }
}

// Affiche la petite boÃ®te pour les tÃ©moignages
function showEmailBox(suffix) {
  const link = document.getElementById("emailLink-" + suffix);
  const box = document.getElementById("emailBox-" + suffix);
  if (link) link.style.display = "none";
  if (box) box.style.display = "block";
}

// Copie l'adresse e-mail (hÃ©ros + bas de page + tÃ©moignages)
function copyEmail(target) {
  let span = null;

  // cas "Top" / "Bottom"
  if (!target || target === "Top" || target === "Bottom") {
    const suffix = target || "Top";
    span = document.getElementById("emailText" + suffix);
  } else {
    // cas "emailText-tem", etc.
    span = document.getElementById(target);
  }

  if (!span) return;

  const txt = span.textContent.trim().replace("[a]", "@");

  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(txt).catch(() => {});
  } else {
    const tmp = document.createElement("textarea");
    tmp.value = txt;
    document.body.appendChild(tmp);
    tmp.select();
    try {
      document.execCommand("copy");
    } catch (e) {}
    document.body.removeChild(tmp);
  }
}

// ===== MODALES =====
function openModal(id) {
  const m = document.getElementById(id);
  if (!m) return;
  m.setAttribute("aria-hidden", "false");
  document.body.style.overflow = "hidden";
  const dlg = m.querySelector(".modal-dialog");
  if (dlg) dlg.focus();
}

function closeModal(m) {
  if (!m) return;
  m.setAttribute("aria-hidden", "true");
  document.body.style.overflow = "";
}

document.addEventListener("click", (e) => {
  const card = e.target.closest(".link-card");
  if (card && card.dataset.modal) {
    e.preventDefault();
    openModal(card.dataset.modal);
  }

  if (e.target.matches("[data-close]")) {
    closeModal(e.target.closest(".modal"));
  }
});

document.addEventListener("keydown", (e) => {
  if (e.key === "Escape") {
    document
      .querySelectorAll('.modal[aria-hidden="false"]')
      .forEach((m) => closeModal(m));
  }
});

// ===== DÃ‰FILEMENT FLUIDE VERS LES ANCRES =====
document.addEventListener("click", (e) => {
  const a = e.target.closest('a[href^="#"]');
  if (!a) return;
  const id = a.getAttribute("href").slice(1);
  const el = document.getElementById(id);
  if (!el) return;

  e.preventDefault();
  el.scrollIntoView({ behavior: "smooth", block: "start" });
});
